# Retinal mesh model

# First iteration of retinal model
# ----------------------------------

# Spat freq
  wm mod ret1/ret_mesh.moo stim/sine_sf.stm ret1/retina.rsp  tn 512  sf 1.2 \
    stim_nrpt 1

# Equiluminant stimuli
  wm mod ret1/ret_mesh.moo stim/test.stm ret1/retina.rsp  tn 512  sf 1.2 \
    stim_nrpt 1

# Second iteration of retinal model
# -----------------------------------

# Flash
  wm mod ret2/Ret_Mesh_H2.moo stim/test_flash.stm ret2/retina.rsp  tn 512

# Cone iso stimuli
  wm mod ret2/Ret_Mesh_H2.moo stim/cone_iso.stm ret2/retina.rsp  tn 512

# Spat freq for RF estimation
  wm mod ret2/Ret_Mesh_H2.moo stim/sine_sf.stm ret2/retina.rsp  tn 512

# Horizontal cell space constant plotting


# Third iteration: break up horiz cells in moo file
# -------------------------------------

# Analyze space constant -- force gp value
  wm mod ret3/Ret_Mesh_H2.moo stim/test_gray.stm ret3/retina.rsp  tn 512 \
    retina0/h_mesh.h1/gp 0.2 \
    retina0/stim_override 1 \
    retina0/mesh_dump_type h_v_dist

# Analyze time constant -- step func
  wm mod ret3/Ret_Mesh_H2.moo stim/test_gray.stm ret3/retina.rsp  tn 512 \
    retina0/h_mesh.h2/gp 0.6 \
    retina0/stim_override 1 \
    retina0/stim_override_binary all

# Flash
  wm mod ret3/Ret_Mesh_H2.moo stim/test_flash.stm ret3/retina.rsp  tn 512 \
    retina0/h_mesh.h2/gp 0.6

# Spat freq for RF estimation
  wm mod ret3/Ret_Mesh_H2.moo stim/sine_sf.stm ret3/retina.rsp  tn 512 \
    retina0/h_mesh.h2/gp 0.6

# Cone iso to square wave
  wm mod ret3/Ret_Mesh_H2.moo stim/cone_iso_step.stm ret3/retina.rsp  tn 512 \
    retina0/h_mesh.h2/gp 0.6
    retina0/bipolar_lm_wh2 0.2

# Cone iso to square wave line of cones
  wm mod ret3/Ret_Mesh_H2.moo stim/cone_iso_step.stm ret3/retina_line.rsp  tn 512 \
    retina0/h_mesh.h2/gp 0.6 \
    retina0/bipolar_lm_wh2 0.6

# Print out mosaic
 wm mod ret3/Ret_Mesh_H2.moo stim/test_flash.stm ret3/retina.rsp  tn 256  gui_flag 1 \
     retina0/mesh_dump_type mosaic_coord \
     retina0/mesh_dump_file zz.mosaic



# Fourth iteration: human parameters
# -------------------------------------

  wm mod ret4/Ret_Mesh_H2.moo stim/sine_sf.stm ret4/retina.rsp  tn 512 \
     gui_flag 1

  wm mod ret4/Ret_Mesh_H2.moo stim/s_iso_step.stm ret4/retina.rsp  tn 512 \
    retina0/h_mesh.h2/gp 0.6

# Show gui
  wm mod ret4/Ret_Mesh_H2.moo stim/s_iso_step.stm ret4/retina.rsp  tn 512 \
    retina0/h_mesh.h2/gp 0.6 \
    gui_flag 1

# noise stimulus
  wm mod ret4/Ret_Mesh_H2.moo stim/noise_64x64.stm ret4/retina.rsp  tn 512 \
    retina0/h_mesh.h2/gp 0.6 


#### Script for optimizing RC parameters
./rc_params.sh 0.1 0.6 2.5 ret4 verbose # h1gp h2gp h2gh model analysis_option


# General routines / analysis / plotting
# ------------------------------------

# Stimulus test

  *** Press 's' (in the main window), and then use ,.<> to move thru the
    stimulus (use 's' to get out of stim mode)
    Press 'h' for help.


# Apply a step function to *all* cones, then you can plot the H-cell trace
    in the nData Viewer to see the time course

  wm mod ret3/Ret_Mesh_H2.moo stim/test_gray.stm ret3/t.rsp  tn 512 \
    retina0/stim_override 1 \
    retina0/stim_override_binary all

# Apply a step function to a single cone at a time half way through the
    simulation, then dump a plot (.pl) file showing the response at all
    H-cell nodes as a function of distance from a specified cone:

  wm mod a/Ret_Mesh_H2.moo a/test_gray.stm a/t.rsp  tn 512 \
    retina0/stim_override 1 \
    retina0/mesh_dump_type h_v_dist

# Display stimulus
  stimv stim/sine_sf.stm 

# Print out mosaic
 wm mod ret2/Ret_Mesh_H2.moo stim/test_flash.stm ret2/retina.rsp  tn 256  gui_flag 1 \
     retina0/mesh_dump_type mosaic_coord \
     retina0/mesh_dump_file zz.mosaic

# Use the nData viewer to see the output (select an h... channel)
  nd zz.nd

# This command calls 'xplot' to plot the 2-column (x,y) text file
  x zz.dist.pl &
